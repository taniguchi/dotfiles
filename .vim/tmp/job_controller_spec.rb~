require 'spec_helper'

describe Scanner::JobController do
  describe 'GET scanner/job/:id' do
    fixtures :scan_jobs

    def do_get
      get :show, {:id => "20130101000000"}, :format => :json
    end

    describe 'route' do
      subject {{:get => "rws/service/scanner/job/1"}}
      it { should route_to(controller: "scanner/job", action: "show", id: "1" )}
    end

    before { do_get }

    describe 'response' do
      subject { response }
      it { should be_success }
    end

    describe 'response.body' do
      subject { response.body }
      it {
        should have_json_path("jobId")
        should have_json_type(String).at_path("jobState")
      }
    end
  end

  describe 'POST scanner/job' do
    def do_post
      post :create, {:sample => "test"}, :format => :json
    end
  
    subject {{:post => "rws/service/scanner/job"}}
    it { should route_to(controller: "scanner/job", action: "create")}

    before { do_post }

    describe 'response' do
      subject { response }
      it { should be_success }
    end

    describe 'response.body' do
      subject { response.body }
      it {
        should have_json_path("jobId")
        should have_json_type(String).at_path("jobId")
      }
    end
  end
end
